//- stats.jade
extends ./layout.jade

block content
  .grid-container(ng-controller='StatsCtrl')
    .grid-x.grid-margin-x(ng-cloak)
      .cell.small-3
        .title Last Block
        .value {{'#'}}{{ bestBlock | number}}

      .cell.small-3
        .title Time Since Last Block
        .value {{ lastBlock | blockTimeFilter }}

      .cell.small-3
        .title Average Block Time
        .value {{ avgBlockTime | avgTimeFilter }}

      .cell.small-3
        .title Active Nodes
        .value {{nodesActive}}/{{nodesTotal}}

      .cell.small-3
        .title Gas Price
        .value {{ bestStats.gasPrice.toString() | gasPriceFilter }}

      .cell.small-3
        .title Gas Limit
        .value {{ bestStats.block.gasLimit | number }}

      .cell.small-3
        .title Page Latency
        .value {{latency}} ms

      .cell.small-3
        .title Validators
        .value {{ bestStats.block.validatorCount | number }}/{{ bestStats.block.maxValidators | number }}

      .cell.small-3
        .title Oracles
        .value {{ bestStats.block.oracleCount | number }}

      .cell.small-3
        .title Min. Validator Deposit
        .value {{ bestStats.block.minDeposit | gasPriceFilter }}

      .cell.small-3
        .title Minted Reward
        .value {{ bestStats.block.mintedReward | gasPriceFilter }}

      .cell.small-3
        .title Stability Fee
        .value {{ bestStats.block.stabilityFee | gasPriceFilter }}

    .grid-x.grid-margin-x(ng-cloak)
      .cell.small-3
        .chart
          .title Gas Spending
          sparkchart.spark-gasspending(data="{{gasSpending.join(',')}}")
      .cell.small-3
        .chart
          .title Transactions
          sparkchart.spark-transactions(data="{{transactionDensity.join(',')}}")
      .cell.small-3
        .chart(class="{{ avgBlockTime | avgTimeClass }}")
          .title Block Time
          sparkchart.spark-blocktimes(data="{{lastBlocksTime.join(',')}}", tooltipsuffix="s")
      .cell.small-3
        .chart.xdouble-chart(class="{{ blockPropagationAvg | propagationAvgTimeClass : true }}")
          .title Currency Market Price
          sparkchart.spark-currency-price(data="{{currencyPrice.join(',')}}", tooltipprefix="$")

    .grid-x.grid-margin-x(ng-cloak)
        table
          thead
            tr
              th(ng-click="orderTable(['info.name'], false)") Node
              th(ng-click="orderTable(['stats.latency'], false)") Latency
              th(ng-click="orderTable(['-stats.peers'], false)") Peers
              th(ng-click="orderTable(['-stats.block.number', 'stats.block.propagation'], false)") Last Block
              th(ng-click="orderTable(['-stats.block.received'], false)") Last Block Time
              th(ng-click="orderTable(['stats.propagationAvg'], false)") Avg. Propagation Time
              th(ng-click="orderTable(['-stats.uptime'], false)") Up Time
          tbody
            tr(ng-repeat='node in nodes | orderBy:predicate track by node.id')
              td {{node.info.name}} {{node.info.node | nodeVersion}}
              td {{ node.readable.latency }}
              td {{node.stats.peers}}
              td {{'#'}}{{ node.stats.block.number | number }}
              td {{node.stats.block.received | blockTimeFilter }}
              td {{node.stats.block.propagation | blockPropagationFilter}}
              td {{ node.stats.uptime | upTimeFilter }}
